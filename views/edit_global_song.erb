<h2>✏️ Edit Global Song</h2>

<% if defined?(@errors) && @errors.any? %>
    <div class="errors">
        <ul>
            <% @errors.each do |error| %>
                <li><%= error %></li>
            <% end %>
        </ul>
    </div>
<% end %>

<div style="margin-bottom: 20px; padding: 15px; background: #fef5e7; border-radius: 8px; border-left: 4px solid #f59e0b;">
    <p style="margin: 0; color: #92400e; font-weight: 500;">
        ⚠️ Warning: You are editing a global song. Changes will be visible to ALL users and will affect new copies made from this global song.
    </p>
</div>

<form method="POST" action="/global_songs/<%= @global_song.id %>" class="card">
    <input type="hidden" name="_method" value="PUT">
    
    <div class="form-group">
        <label for="global_song_title">Title *</label>
        <input type="text" id="global_song_title" name="global_song[title]" value="<%= @global_song.title %>" required>
    </div>

    <div class="form-group">
        <label for="global_song_artist">Artist *</label>
        <input type="text" id="global_song_artist" name="global_song[artist]" value="<%= @global_song.artist %>" required>
    </div>

    <div style="display: grid; grid-template-columns: 1fr; gap: 20px;">
        <style>
            @media (min-width: 768px) {
                .form-grid {
                    grid-template-columns: 1fr 1fr !important;
                }
            }
        </style>
        <div class="form-grid" style="display: grid; grid-template-columns: 1fr; gap: 20px;">
            <div class="form-group">
                <label for="global_song_key">Key *</label>
                <select id="global_song_key" name="global_song[key]" required>
                    <option value="">Select Key</option>
                    <option value="C" <%= 'selected' if @global_song.key == 'C' %>>C</option>
                    <option value="C#/Db" <%= 'selected' if @global_song.key == 'C#/Db' %>>C#/Db</option>
                    <option value="D" <%= 'selected' if @global_song.key == 'D' %>>D</option>
                    <option value="D#/Eb" <%= 'selected' if @global_song.key == 'D#/Eb' %>>D#/Eb</option>
                    <option value="E" <%= 'selected' if @global_song.key == 'E' %>>E</option>
                    <option value="F" <%= 'selected' if @global_song.key == 'F' %>>F</option>
                    <option value="F#/Gb" <%= 'selected' if @global_song.key == 'F#/Gb' %>>F#/Gb</option>
                    <option value="G" <%= 'selected' if @global_song.key == 'G' %>>G</option>
                    <option value="G#/Ab" <%= 'selected' if @global_song.key == 'G#/Ab' %>>G#/Ab</option>
                    <option value="A" <%= 'selected' if @global_song.key == 'A' %>>A</option>
                    <option value="A#/Bb" <%= 'selected' if @global_song.key == 'A#/Bb' %>>A#/Bb</option>
                    <option value="B" <%= 'selected' if @global_song.key == 'B' %>>B</option>
                </select>
            </div>

            <div class="form-group">
                <label for="global_song_original_key">Original Key</label>
                <select id="global_song_original_key" name="global_song[original_key]">
                    <option value="">Select Original Key</option>
                    <option value="C" <%= 'selected' if @global_song.original_key == 'C' %>>C</option>
                    <option value="C#/Db" <%= 'selected' if @global_song.original_key == 'C#/Db' %>>C#/Db</option>
                    <option value="D" <%= 'selected' if @global_song.original_key == 'D' %>>D</option>
                    <option value="D#/Eb" <%= 'selected' if @global_song.original_key == 'D#/Eb' %>>D#/Eb</option>
                    <option value="E" <%= 'selected' if @global_song.original_key == 'E' %>>E</option>
                    <option value="F" <%= 'selected' if @global_song.original_key == 'F' %>>F</option>
                    <option value="F#/Gb" <%= 'selected' if @global_song.original_key == 'F#/Gb' %>>F#/Gb</option>
                    <option value="G" <%= 'selected' if @global_song.original_key == 'G' %>>G</option>
                    <option value="G#/Ab" <%= 'selected' if @global_song.original_key == 'G#/Ab' %>>G#/Ab</option>
                    <option value="A" <%= 'selected' if @global_song.original_key == 'A' %>>A</option>
                    <option value="A#/Bb" <%= 'selected' if @global_song.original_key == 'A#/Bb' %>>A#/Bb</option>
                    <option value="B" <%= 'selected' if @global_song.original_key == 'B' %>>B</option>
                </select>
            </div>
        </div>
    </div>

    <div style="display: grid; grid-template-columns: 1fr; gap: 20px;">
        <div class="form-grid" style="display: grid; grid-template-columns: 1fr; gap: 20px;">
            <div class="form-group">
                <label for="global_song_tempo">Tempo (BPM)</label>
                <input type="number" id="global_song_tempo" name="global_song[tempo]" value="<%= @global_song.tempo %>" min="1" max="300">
            </div>

            <div class="form-group">
                <label for="global_song_genre">Genre</label>
                <input type="text" id="global_song_genre" name="global_song[genre]" value="<%= @global_song.genre %>" placeholder="e.g., Rock, Jazz, Pop">
            </div>
        </div>
    </div>

    <div style="display: grid; grid-template-columns: 1fr; gap: 20px;">
        <div class="form-grid" style="display: grid; grid-template-columns: 1fr; gap: 20px;">
            <div class="form-group">
                <label for="global_song_duration">Duration</label>
                <input type="text" id="global_song_duration" name="global_song[duration]" value="<%= @global_song.duration %>" placeholder="e.g., 3:45">
            </div>

            <div class="form-group">
                <label for="global_song_year">Year</label>
                <input type="number" id="global_song_year" name="global_song[year]" value="<%= @global_song.year %>" min="1900" max="2030" placeholder="e.g., 2020">
            </div>
        </div>
    </div>

    <div class="form-group">
        <label for="global_song_album">Album</label>
        <input type="text" id="global_song_album" name="global_song[album]" value="<%= @global_song.album %>" placeholder="Album name">
    </div>

    <div class="form-group">
        <label for="global_song_url">Streaming URL</label>
        <input type="url" id="global_song_url" name="global_song[url]" value="<%= @global_song.url %>" placeholder="https://www.youtube.com/watch?v=... or Spotify/Apple Music link">
    </div>

    <div class="form-group">
        <label for="global_song_notes">Notes</label>
        <textarea id="global_song_notes" name="global_song[notes]" rows="4" placeholder="Any additional notes about the song, chords, etc."><%= @global_song.notes %></textarea>
    </div>

    <div class="form-group">
        <label for="global_song_lyrics">Lyrics</label>
        <textarea id="global_song_lyrics" name="global_song[lyrics]" rows="8" placeholder="Song lyrics..."><%= @global_song.lyrics %></textarea>
    </div>

    <div class="actions">
        <button type="submit" class="btn btn-success" onclick="return confirmUpdate()">Update Global Song</button>
        <a href="/global_songs/<%= @global_song.id %>" class="btn">Cancel</a>
    </div>
</form>

<script>
function confirmUpdate() {
    return confirm('⚠️ Warning: You are about to update a global song.\n\nThis will change the song information for ALL users who have access to the global song library. Existing band-specific copies will not be affected, but new copies will use the updated information.\n\nAre you sure you want to continue?');
}
</script>