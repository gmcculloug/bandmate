<div style="max-width: 600px; margin: 0 auto;">
    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 30px;">
        <h2>ðŸŽ¸ Edit Band</h2>
        <a href="/bands/<%= @band.id %>" class="btn">Back to Band</a>
    </div>

    <% if @errors %>
        <div class="errors" style="margin-bottom: 20px;">
            <% @errors.each do |error| %>
                <p><%= error %></p>
            <% end %>
        </div>
    <% end %>

    <% if @band.owner? %>
        <div style="margin-bottom: 20px; padding: 15px; background: #f0f9ff; border-radius: 8px; border-left: 4px solid #0ea5e9;">
            <p style="margin: 0; color: #0c4a6e; font-weight: 500;">
                ðŸ‘‘ You are the owner of this band. Only you can edit band details and manage members.
            </p>
        </div>
    <% end %>

    <div class="card" style="margin-bottom: 30px;">
        <h3>ðŸ‘¥ Band Members</h3>
        <p style="color: #666; margin-bottom: 15px;">
            <% if @band.owned_by?(current_user) %>
                As the band owner, you can add and remove members. Members can leave the band themselves.
            <% else %>
                Only the band owner can manage members. You can leave the band if needed.
            <% end %>
        </p>
        
        <% if @user_error %>
            <div class="errors" style="margin-bottom: 20px;">
                <p><%= @user_error %></p>
            </div>
        <% end %>
        
        <% if @user_success %>
            <div class="success" style="margin-bottom: 20px;">
                <p><%= @user_success %></p>
            </div>
        <% end %>

        <div style="margin-bottom: 20px;">
            <% if @band.users.any? %>
                <div style="margin-bottom: 20px;">
                    <h4>Current Members</h4>
                    <% @band.users.order(:username).each do |user| %>
                        <div style="display: flex; justify-content: space-between; align-items: center; padding: 8px; border: 1px solid #e2e8f0; border-radius: 4px; margin-bottom: 5px;">
                            <span style="font-weight: 500;">
                                <%= user.username %>
                                <% if user == current_user %>
                                    <span style="background: #667eea; color: white; padding: 2px 6px; border-radius: 10px; font-size: 0.75rem; margin-left: 8px;">You</span>
                                <% end %>
                            </span>
                            <% if @band.users.count > 1 %>
                                <% if user == current_user %>
                                    <form method="POST" action="/bands/<%= @band.id %>/remove_user" style="display: inline;">
                                        <input type="hidden" name="user_id" value="<%= user.id %>">
                                        <button type="submit" class="btn btn-danger" style="font-size: 0.8rem; padding: 3px 8px;" onclick="return confirm('Leave this band? You will no longer have access to its songs and set lists.')">Leave Band</button>
                                    </form>
                                <% elsif @band.owned_by?(current_user) %>
                                    <form method="POST" action="/bands/<%= @band.id %>/remove_user" style="display: inline;">
                                        <input type="hidden" name="user_id" value="<%= user.id %>">
                                        <button type="submit" class="btn btn-danger" style="font-size: 0.8rem; padding: 3px 8px;" onclick="return confirm('Remove <%= user.username %> from this band?')">Remove</button>
                                    </form>
                                <% end %>
                            <% elsif user == current_user %>
                                <span style="font-size: 0.8rem; color: #999; padding: 3px 8px;">Last member</span>
                            <% end %>
                        </div>
                    <% end %>
                </div>
            <% end %>

            <% if @band.owned_by?(current_user) %>
                <h4>Add New Member</h4>
                <form method="POST" action="/bands/<%= @band.id %>/add_user" style="display: flex; gap: 10px; align-items: end;">
                    <div style="flex: 1;">
                        <label for="username" style="display: block; margin-bottom: 5px; font-weight: bold;">Username</label>
                        <input type="text" id="username" name="username" required style="width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 4px; font-size: 16px;" placeholder="Enter username to add">
                    </div>
                    <button type="submit" class="btn btn-success">Add Member</button>
                </form>
                <small style="color: #666; margin-top: 5px; display: block;">Enter the exact username of the user you want to add to this band.</small>
            <% end %>
        </div>
    </div>

    <div class="card">
        <form method="POST" action="/bands/<%= @band.id %>">
            <input type="hidden" name="_method" value="PUT">
            
            <div style="margin-bottom: 20px;">
                <label for="band_name" style="display: block; margin-bottom: 5px; font-weight: bold;">Band Name *</label>
                <input type="text" id="band_name" name="band[name]" value="<%= @band.name %>" required autofocus style="width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 4px; font-size: 16px;">
            </div>

            <div style="margin-bottom: 20px;">
                <label for="band_notes" style="display: block; margin-bottom: 5px; font-weight: bold;">Notes</label>
                <textarea id="band_notes" name="band[notes]" rows="4" style="width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 4px; font-size: 16px; font-family: inherit;"><%= @band.notes %></textarea>
                <small style="color: #666;">Optional notes about the band, members, style, etc.</small>
            </div>

            <div class="actions">
                <button type="submit" class="btn btn-success">Update Band</button>
                <a href="/bands/<%= @band.id %>" class="btn">Cancel</a>
            </div>
        </form>
    </div>
</div> 