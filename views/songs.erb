<div class="page-header">
    <h2 class="page-title">üéµ Songs (<%= @songs.count %>)</h2>
    <div class="page-actions">
        <a href="/songs/copy_from_global" class="btn btn-primary">üìã Copy from Global Song list</a>
        <a href="/global_songs" class="btn btn-secondary">üåç Global Songs</a>
        <a href="/global_songs/new" class="btn btn-success">‚ûï Add Songs</a>
    </div>
</div>

<div style="margin-bottom: 20px;">
    <div style="position: relative; max-width: 400px;">
        <input type="text" id="search-input" value="<%= @search %>" placeholder="Search songs by title or artist..." style="width: 100%; padding: 10px 40px 10px 10px; border: 2px solid #e2e8f0; border-radius: 8px; font-size: 16px;">
        <% if @search.present? %>
            <a href="/songs" style="position: absolute; right: 10px; top: 50%; transform: translateY(-50%); background: none; border: none; color: #718096; font-size: 18px; cursor: pointer; text-decoration: none; display: flex; align-items: center; justify-content: center; width: 20px; height: 20px;">‚úï</a>
        <% end %>
    </div>
</div>

<script>
let searchTimeout;

document.getElementById('search-input').addEventListener('input', function() {
    clearTimeout(searchTimeout);
    searchTimeout = setTimeout(function() {
        filterSongs();
    }, 500);
});

document.getElementById('search-input').addEventListener('keypress', function(e) {
    if (e.key === 'Enter') {
        e.preventDefault();
        filterSongs();
    }
});

function filterSongs() {
    const searchTerm = document.getElementById('search-input').value;
    const currentUrl = new URL(window.location);
    
    if (searchTerm.trim() === '') {
        currentUrl.searchParams.delete('search');
    } else {
        currentUrl.searchParams.set('search', searchTerm);
    }
    
    window.location.href = currentUrl.toString();
}

// Focus the search input when page loads if there's a search term
document.addEventListener('DOMContentLoaded', function() {
    const searchInput = document.getElementById('search-input');
    if (searchInput && searchInput.value.trim() !== '') {
        // Small delay to ensure the page is fully loaded
        setTimeout(function() {
            searchInput.focus();
            // Move cursor to end of text
            searchInput.setSelectionRange(searchInput.value.length, searchInput.value.length);
        }, 100);
    }
});
</script>

<% if params[:copied] %>
    <div class="message message--success">
        ‚úÖ Successfully copied <%= params[:copied] %> song<%= params[:copied].to_i == 1 ? '' : 's' %> to your band!
    </div>
<% end %>

<% if @search.present? %>
    <div class="message message--info">
        Showing results for "<strong><%= @search %></strong>"
        (<%= @songs.count %> song<%= @songs.count == 1 ? '' : 's' %>)
    </div>
<% end %>

<% if @songs.any? %>
    <div style="display: flex; flex-direction: column; gap: 2px;">
        <% @songs.each do |song| %>
            <div class="song-card" style="padding: 8px 12px; margin-bottom: 0; cursor: pointer; border-radius: 4px;" onclick="window.location.href='/songs/<%= song.id %>'">
                <div style="display: flex; justify-content: space-between; align-items: center; gap: 10px;">
                    <div style="flex: 1; min-width: 0; display: flex; align-items: center; gap: 10px;">
                        <div style="font-weight: bold; color: #2d3748; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; min-width: 0; flex: 1;">
                            <%= song.title %>
                            <% if song.artist.present? %>
                                <span style="color: #718096; font-weight: normal; font-size: 0.9rem;"> ‚Ä¢ <%= song.artist %></span>
                            <% end %>
                        </div>
                        <div style="display: flex; align-items: center; gap: 6px; flex-shrink: 0;">
                            <span style="background: #667eea; color: white; padding: 2px 6px; border-radius: 10px; font-size: 0.75rem;">
                                <%= song.key %>
                            </span>
                            <% if song.tempo %>
                                <span style="background: #38a169; color: white; padding: 2px 6px; border-radius: 10px; font-size: 0.75rem;">
                                    <%= song.tempo %> BPM
                                </span>
                            <% end %>
                        </div>
                    </div>
                    <div class="actions" onclick="event.stopPropagation();" style="display: flex; gap: 5px; flex-shrink: 0;">
                        <% if song.url.present? %>
                            <a href="<%= song.url %>" target="_blank" class="btn btn-small" style="padding: 4px 8px; font-size: 0.75rem; min-height: 28px;">üéµ</a>
                        <% end %>
                    </div>
                </div>
            </div>
        <% end %>
    </div>
<% else %>
    <div class="card">
        <h3>No songs yet!</h3>
        <p>Get started by adding your first song to the library.</p>
    </div>
<% end %> 