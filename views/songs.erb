<div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
    <h2>üéµ Songs</h2>
    <a href="/songs/new" class="btn btn-success">‚ûï Add New Song</a>
</div>

<div style="margin-bottom: 20px;">
    <div style="display: flex; gap: 10px; align-items: center;">
        <input type="text" id="search-input" value="<%= @search %>" placeholder="Search songs by title or artist..." style="flex: 1; padding: 10px; border: 2px solid #e2e8f0; border-radius: 8px; font-size: 16px;">
        <button type="button" onclick="filterSongs()" class="btn" style="padding: 10px 20px;">üîç Filter</button>
        <% if @search.present? %>
            <a href="/songs" class="btn" style="padding: 10px 20px;">Clear</a>
        <% end %>
    </div>
</div>

<script>
let searchTimeout;

document.getElementById('search-input').addEventListener('input', function() {
    clearTimeout(searchTimeout);
    searchTimeout = setTimeout(function() {
        filterSongs();
    }, 500);
});

document.getElementById('search-input').addEventListener('keypress', function(e) {
    if (e.key === 'Enter') {
        e.preventDefault();
        filterSongs();
    }
});

function filterSongs() {
    const searchTerm = document.getElementById('search-input').value;
    const currentUrl = new URL(window.location);
    
    if (searchTerm.trim() === '') {
        currentUrl.searchParams.delete('search');
    } else {
        currentUrl.searchParams.set('search', searchTerm);
    }
    
    window.location.href = currentUrl.toString();
}

// Focus the search input when page loads if there's a search term
document.addEventListener('DOMContentLoaded', function() {
    const searchInput = document.getElementById('search-input');
    if (searchInput && searchInput.value.trim() !== '') {
        // Small delay to ensure the page is fully loaded
        setTimeout(function() {
            searchInput.focus();
            // Move cursor to end of text
            searchInput.setSelectionRange(searchInput.value.length, searchInput.value.length);
        }, 100);
    }
});
</script>

<% if @search.present? %>
    <div style="margin-bottom: 20px; padding: 10px; background: #f7fafc; border-radius: 8px; border-left: 4px solid #667eea;">
        <p style="margin: 0; color: #4a5568;">
            Showing results for "<strong><%= @search %></strong>" 
            (<%= @songs.count %> song<%= @songs.count == 1 ? '' : 's' %>)
        </p>
    </div>
<% end %>

<% if @songs.any? %>
    <div style="display: flex; flex-direction: column; gap: 8px;">
        <% @songs.each do |song| %>
            <div class="song-card" style="padding: 15px; margin-bottom: 0; cursor: pointer;" onclick="window.location.href='/songs/<%= song.id %>'">
                <div style="display: flex; justify-content: space-between; align-items: center;">
                    <div style="flex: 1;">
                        <div style="font-weight: bold; color: #2d3748; margin-bottom: 3px;"><%= song.title %></div>
                        <div style="color: #718096; font-size: 0.9rem; margin-bottom: 5px;"><%= song.artist %></div>
                        <div style="font-size: 0.8rem; color: #a0aec0;">
                            <span style="background: #667eea; color: white; padding: 2px 6px; border-radius: 10px; margin-right: 8px;">
                                <%= song.key %>
                            </span>
                            <% if song.original_key.present? %>
                                <span style="background: #9f7aea; color: white; padding: 2px 6px; border-radius: 10px; margin-right: 8px;">
                                    Orig: <%= song.original_key %>
                                </span>
                            <% end %>
                            <% if song.tempo %>
                                <span style="background: #38a169; color: white; padding: 2px 6px; border-radius: 10px; margin-right: 8px;">
                                    <%= song.tempo %> BPM
                                </span>
                            <% end %>
                            <% song.bands.each do |band| %>
                                <span style="background: #ed8936; color: white; padding: 2px 6px; border-radius: 10px; margin-right: 4px;">
                                    <%= band.name %>
                                </span>
                            <% end %>
                        </div>
                    </div>
                    <div class="actions" onclick="event.stopPropagation();" style="margin-left: 15px; display: flex; gap: 5px;">
                        <% if song.url.present? %>
                            <a href="<%= song.url %>" target="_blank" class="btn" style="padding: 6px 12px; font-size: 0.8rem;">üéµ</a>
                        <% end %>
                        <a href="/songs/<%= song.id %>/edit" class="btn" style="padding: 6px 12px; font-size: 0.8rem;">Edit</a>
                        <form method="POST" action="/songs/<%= song.id %>" style="display: inline;">
                            <input type="hidden" name="_method" value="DELETE">
                            <button type="submit" class="btn btn-danger" onclick="return confirm('Are you sure you want to delete this song?')" style="padding: 6px 12px; font-size: 0.8rem;">Delete</button>
                        </form>
                    </div>
                </div>
            </div>
        <% end %>
    </div>
<% else %>
    <div class="card">
        <h3>No songs yet!</h3>
        <p>Get started by adding your first song to the library.</p>
        <a href="/songs/new" class="btn btn-success">Add Your First Song</a>
    </div>
<% end %> 