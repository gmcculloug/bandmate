<div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; flex-wrap: wrap; gap: 10px;">
    <h2>✏️ Edit Song: <%= @song.title %></h2>
    <div class="actions">
        <button type="submit" form="edit-song-form" class="btn btn-success">Update Song</button>
        <a href="/songs" class="btn">Cancel</a>
    </div>
</div>

<% if defined?(@errors) && @errors.any? %>
    <div class="errors">
        <ul>
            <% @errors.each do |error| %>
                <li><%= error %></li>
            <% end %>
        </ul>
    </div>
<% end %>

<form method="POST" action="/songs/<%= @song.id %>" class="card" id="edit-song-form">
    <input type="hidden" name="_method" value="PUT">
    
    <div class="form-group">
        <label for="song_title">Title *</label>
        <input type="text" id="song_title" name="song[title]" value="<%= @song.title %>" required autofocus>
    </div>

    <div class="form-group">
        <label for="song_artist">Artist *</label>
        <input type="text" id="song_artist" name="song[artist]" value="<%= @song.artist %>" required>
    </div>

    <% if @song.bands.any? %>
        <div style="margin-bottom: 20px; padding: 15px; background: #f0f4f8; border-radius: 8px; border-left: 4px solid #667eea;">
            <h4 style="margin: 0 0 8px 0; color: #4a5568;">Associated Bands</h4>
            <div style="display: flex; flex-wrap: wrap; gap: 8px;">
                <% @song.bands.each do |band| %>
                    <span style="background: #ed8936; color: white; padding: 4px 8px; border-radius: 12px; font-size: 0.9rem;">
                        <%= band.name %>
                    </span>
                <% end %>
            </div>
            <p style="margin: 8px 0 0 0; color: #666; font-size: 0.9rem;">
                Band associations are managed through the copy process from the Song Catalog.
            </p>
        </div>
    <% else %>
        <div style="margin-bottom: 20px; padding: 15px; background: #e6fffa; border-radius: 8px; border-left: 4px solid #38a169;">
            <p style="margin: 0; color: #2f855a; font-weight: 500;">
                ℹ️ This song is not yet associated with any bands. Bands can copy this song from the Song Catalog.
            </p>
        </div>
    <% end %>

    <div style="display: grid; grid-template-columns: 1fr; gap: 20px;">
        <style>
            @media (min-width: 768px) {
                .form-grid {
                    grid-template-columns: 1fr 1fr !important;
                }
            }
        </style>
        <div class="form-grid" style="display: grid; grid-template-columns: 1fr; gap: 20px;">
            <div class="form-group">
                <label for="song_key">Key *</label>
                <input type="text" id="song_key" name="song[key]" value="<%= @song.key %>" list="key_options" required placeholder="Select or type key (e.g., C, Dm, F#)">
                <datalist id="key_options">
                    <% ['C', 'C#/Db', 'D', 'D#/Eb', 'E', 'F', 'F#/Gb', 'G', 'G#/Ab', 'A', 'A#/Bb', 'B', 'Cm', 'C#m/Dbm', 'Dm', 'D#m/Ebm', 'Em', 'Fm', 'F#m/Gbm', 'Gm', 'G#m/Abm', 'Am', 'A#m/Bbm', 'Bm'].each do |key| %>
                        <option value="<%= key %>"><%= key %></option>
                    <% end %>
                </datalist>
            </div>

            <div class="form-group">
                <label for="song_original_key">Original Key</label>
                <input type="text" id="song_original_key" name="song[original_key]" value="<%= @song.original_key %>" list="original_key_options" placeholder="Select or type original key (e.g., C, Dm, F#)">
                <datalist id="original_key_options">
                    <% ['C', 'C#/Db', 'D', 'D#/Eb', 'E', 'F', 'F#/Gb', 'G', 'G#/Ab', 'A', 'A#/Bb', 'B', 'Cm', 'C#m/Dbm', 'Dm', 'D#m/Ebm', 'Em', 'Fm', 'F#m/Gbm', 'Gm', 'G#m/Abm', 'Am', 'A#m/Bbm', 'Bm'].each do |key| %>
                        <option value="<%= key %>"><%= key %></option>
                    <% end %>
                </datalist>
            </div>
        </div>
    </div>

    <div style="display: grid; grid-template-columns: 1fr; gap: 20px;">
        <div class="form-grid" style="display: grid; grid-template-columns: 1fr; gap: 20px;">
            <div class="form-group">
                <label for="song_tempo">Tempo (BPM)</label>
                <input type="number" id="song_tempo" name="song[tempo]" value="<%= @song.tempo %>" min="1" max="300">
            </div>

            <div class="form-group">
                <label for="song_genre">Genre</label>
                <input type="text" id="song_genre" name="song[genre]" value="<%= @song.genre %>" placeholder="e.g., Rock, Jazz, Pop">
            </div>
        </div>
    </div>

    <div style="display: grid; grid-template-columns: 1fr; gap: 20px;">
        <div class="form-grid" style="display: grid; grid-template-columns: 1fr; gap: 20px;">
            <div class="form-group">
                <label for="song_duration">Duration *</label>
                <input type="text" id="song_duration" name="song[duration]" value="<%= @song.duration %>" placeholder="e.g., 3:45" required>
            </div>

            <div class="form-group">
                <label for="song_year">Year</label>
                <input type="number" id="song_year" name="song[year]" value="<%= @song.year %>" min="1900" max="2030" placeholder="e.g., 2020">
            </div>
        </div>
    </div>

    <div class="form-group">
        <label for="song_album">Album</label>
        <input type="text" id="song_album" name="song[album]" value="<%= @song.album %>" placeholder="Album name">
    </div>

    <div class="form-group">
        <label for="song_url">Streaming URL</label>
        <input type="url" id="song_url" name="song[url]" value="<%= @song.url %>" placeholder="https://www.youtube.com/watch?v=... or Spotify/Apple Music link">
    </div>

    <div class="form-group">
        <label for="song_notes">Set List Notes <span style="color: #718096; font-weight: normal; font-size: 0.9rem;">(visible on gig screen and printed set list)</span></label>
        <textarea id="song_notes" name="song[notes]" rows="4" placeholder="Notes that will appear on the gig screen and printed set list (e.g., intro notes, special instructions, etc.)"><%= @song.notes %></textarea>
    </div>

    <div class="form-group">
        <label for="song_lyrics">Lyrics</label>
        <textarea id="song_lyrics" name="song[lyrics]" rows="8" placeholder="Song lyrics..."><%= @song.lyrics %></textarea>
    </div>

    <div class="actions">
        <button type="submit" class="btn btn-success">Update Song</button>
        <a href="/songs" class="btn">Cancel</a>
    </div>
</form>

<script>
document.addEventListener('DOMContentLoaded', function() {
    const keyInput = document.getElementById('song_key');
    const originalKeyInput = document.getElementById('song_original_key');

    // Auto-populate original key when key is changed (if original key is empty)
    keyInput.addEventListener('input', function() {
        // Only set original key if it hasn't been set yet (is empty)
        if (originalKeyInput.value === '') {
            originalKeyInput.value = this.value;
        }
    });

    // Also trigger on datalist selection (change event)
    keyInput.addEventListener('change', function() {
        // Only set original key if it hasn't been set yet (is empty)
        if (originalKeyInput.value === '') {
            originalKeyInput.value = this.value;
        }
    });
});
</script> 