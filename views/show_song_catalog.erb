<% if params[:copied] %>
    <div style="margin-bottom: 20px; padding: 15px; background: #f0fff4; border-radius: 8px; border-left: 4px solid #38a169;">
        <p style="margin: 0; color: #2f855a; font-weight: 500;">
            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="vertical-align: -2px; margin-right: 6px;"><polyline points="20,6 9,17 4,12"></polyline></svg>Song successfully copied to <%= params[:copied] == '1' ? '1 band' : "#{params[:copied]} bands" %>!
        </p>
    </div>
<% end %>

<div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 30px;">
    <h2>
        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="vertical-align: -3px; margin-right: 8px;"><circle cx="12" cy="12" r="10"></circle><line x1="2" y1="12" x2="22" y2="12"></line><path d="M12 2a15.3 15.3 0 0 1 4 10 15.3 15.3 0 0 1-4 10 15.3 15.3 0 0 1-4-10 15.3 15.3 0 0 1 4-10z"></path></svg><%= @song_catalog.title %>
        <% if @song_catalog.archived? %>
            <span style="background: #e53e3e; color: white; padding: 4px 8px; border-radius: 10px; font-size: 0.7rem; margin-left: 12px; font-weight: normal;">üóÉÔ∏è ARCHIVED</span>
        <% end %>
    </h2>
    <div class="actions">
        <a href="/song_catalogs/<%= @song_catalog.id %>/edit" class="btn">Edit</a>
    </div>
</div>

<% if @song_catalog.archived? %>
    <div style="margin-bottom: 20px; padding: 15px; background: #fed7d7; border-radius: 8px; border-left: 4px solid #e53e3e;">
        <p style="margin: 0; color: #c53030; font-weight: 500;">
            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="vertical-align: -2px; margin-right: 6px;"><polyline points="21,8 21,21 3,21 3,8"></polyline><rect x="1" y="3" width="22" height="5"></rect><line x1="10" y1="12" x2="14" y2="12"></line></svg>This song catalog entry is archived and cannot be copied to bands. It can be unarchived from the edit page.
        </p>
    </div>
<% end %>

<div class="card">
    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 30px;">
        <div>
            <h3>Song Details</h3>
            <div class="song-details">
                <div class="detail-item">
                    <span class="detail-label">Artist:</span> <%= @song_catalog.artist %>
                    <% if @song_catalog.album.present? %>
                        <span style="color: #718096; margin-left: 10px;">‚Ä¢ Album: <%= @song_catalog.album %></span>
                    <% end %>
                </div>
                <div class="detail-item">
                    <span class="detail-label">Key:</span> <%= @song_catalog.key %>
                </div>
                <div class="detail-item">
                    <span class="detail-label">Original Key:</span> <%= @song_catalog.original_key || 'N/A' %>
                </div>
                <div class="detail-item">
                    <span class="detail-label">Tempo:</span> <%= @song_catalog.tempo ? "#{@song_catalog.tempo} BPM" : 'N/A' %>
                </div>
                <div class="detail-item">
                    <span class="detail-label">Genre:</span> <%= @song_catalog.genre || 'N/A' %>
                </div>
                <div class="detail-item">
                    <span class="detail-label">Duration:</span> <%= @song_catalog.duration || 'N/A' %>
                </div>
                <div class="detail-item">
                    <span class="detail-label">Year:</span> <%= @song_catalog.year || 'N/A' %>
                </div>
            </div>
        </div>

        <div>
            <h3>Actions</h3>
            <% if @song_catalog.url.present? %>
                <div style="margin-bottom: 20px;">
                    <a href="<%= @song_catalog.url %>" target="_blank" class="btn btn-success"><svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="vertical-align: -2px; margin-right: 6px;"><path d="M9 18V5l12-2v13"></path><circle cx="6" cy="18" r="3"></circle><circle cx="18" cy="16" r="3"></circle></svg>Listen on Streaming Platform</a>
                </div>
            <% end %>
            
            <% unless @song_catalog.archived? %>
                <div style="margin-bottom: 20px;">
                    <h4>Copy to Band</h4>
                    <% if @bands.any? %>
                        <p style="color: #666; font-size: 0.9rem; margin-bottom: 10px;">
                            Select a band to copy this song to their repertoire:
                        </p>
                        <% @bands.each do |band| %>
                            <% existing_copy = band.songs.find_by(song_catalog_id: @song_catalog.id) %>
                            <% if existing_copy %>
                                <div style="margin-bottom: 8px; padding: 8px; background: #f0f4f8; border-radius: 4px; color: #666;">
                                    <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="vertical-align: -2px; margin-right: 4px;"><polyline points="20,6 9,17 4,12"></polyline></svg>Already copied to <%= band.name %>
                                </div>
                            <% else %>
                                <form method="POST" action="/bands/<%= band.id %>/copy_songs" style="margin-bottom: 8px;">
                                    <input type="hidden" name="song_catalog_ids[]" value="<%= @song_catalog.id %>">
                                    <input type="hidden" name="from_song_catalog" value="<%= @song_catalog.id %>">
                                    <button type="submit" class="btn" style="width: 100%; text-align: left;">
                                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="vertical-align: -2px; margin-right: 6px;"><rect x="9" y="9" width="13" height="13" rx="2" ry="2"></rect><path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"></path></svg>Copy to <%= band.name %>
                                    </button>
                                </form>
                            <% end %>
                        <% end %>
                    <% else %>
                        <p style="color: #666; font-size: 0.9rem; margin-bottom: 10px;">
                            You need to be a member of at least one band to copy songs.
                            <a href="/bands/new" class="btn btn-success" style="margin-top: 10px; display: inline-block;">Create a Band</a>
                        </p>
                    <% end %>
                </div>
            <% end %>

            <div>
                <h4>Usage Statistics</h4>
                <% song_copies = @song_catalog.songs.includes(:bands) %>
                <div class="detail-item">
                    <span class="detail-label">Copied by:</span> 
                    <% if song_copies.any? %>
                        <%= song_copies.count %> band<%= song_copies.count == 1 ? '' : 's' %>
                        <div style="margin-top: 5px; font-size: 0.85rem;">
                            <% song_copies.group_by(&:bands).each do |bands, songs| %>
                                <% bands.each do |band| %>
                                    <span style="background: #ed8936; color: white; padding: 2px 6px; border-radius: 10px; margin-right: 4px;">
                                        <%= band.name %>
                                    </span>
                                <% end %>
                            <% end %>
                        </div>
                    <% else %>
                        Not copied yet
                    <% end %>
                </div>
            </div>
        </div>
    </div>

    <% if @song_catalog.notes.present? %>
        <div style="margin-top: 30px;">
            <h3>Notes</h3>
            <div style="background: #f7fafc; padding: 20px; border-radius: 8px; white-space: pre-wrap;">
                <%= @song_catalog.notes %>
            </div>
        </div>
    <% end %>

    <% if @song_catalog.lyrics.present? %>
        <div style="margin-top: 30px;">
            <h3>Lyrics</h3>
            <div style="background: #f7fafc; padding: 20px; border-radius: 8px; white-space: pre-wrap; font-family: monospace;">
                <%= @song_catalog.lyrics %>
            </div>
        </div>
    <% end %>
</div>