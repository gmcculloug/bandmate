<div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; flex-wrap: wrap; gap: 10px;">
    <h2><svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="vertical-align: -3px; margin-right: 8px;"><path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"></path><path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"></path></svg>Edit Song Catalog</h2>
    <div class="actions">
        <button type="submit" form="edit-song-catalog-form" class="btn btn-success" onclick="return confirmUpdate()">Update Song Catalog</button>
        <a href="/song_catalogs/<%= @song_catalog.id %>" class="btn">Cancel</a>
    </div>
</div>

<%= erb :_errors %>

<div style="margin-bottom: 20px; padding: 15px; background: #fef5e7; border-radius: 8px; border-left: 4px solid #f59e0b;">
    <p style="margin: 0; color: #92400e; font-weight: 500;">
        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="vertical-align: -2px; margin-right: 6px;"><path d="M10.29 3.86L1.82 18a2 2 0 0 0 1.71 3h16.94a2 2 0 0 0 1.71-3L13.71 3.86a2 2 0 0 0-3.42 0z"></path><line x1="12" y1="9" x2="12" y2="13"></line><line x1="12" y1="17" x2="12.01" y2="17"></line></svg>Warning: You are editing a song catalog entry. Changes will be visible to ALL users and will affect new copies made from this song catalog entry.
    </p>
</div>

<form method="POST" action="/song_catalogs/<%= @song_catalog.id %>" class="card" id="edit-song-catalog-form">
    <input type="hidden" name="_method" value="PUT">
    
    <div class="form-group">
        <label for="song_catalog_title">Title *</label>
        <input type="text" id="song_catalog_title" name="song_catalog[title]" value="<%= @song_catalog.title %>" required autofocus>
    </div>

    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px;">
        <div class="form-group">
            <label for="song_catalog_artist">Artist *</label>
            <input type="text" id="song_catalog_artist" name="song_catalog[artist]" value="<%= @song_catalog.artist %>" required>
        </div>

        <div class="form-group">
            <label for="song_catalog_album">Album</label>
            <input type="text" id="song_catalog_album" name="song_catalog[album]" value="<%= @song_catalog.album %>" placeholder="Album name">
        </div>
    </div>

    <div style="display: grid; grid-template-columns: 1fr; gap: 20px;">
        <style>
            @media (min-width: 768px) {
                .form-grid {
                    grid-template-columns: 1fr 1fr !important;
                }
            }
        </style>
        <div class="form-grid" style="display: grid; grid-template-columns: 1fr; gap: 20px;">
            <div class="form-group">
                <label for="song_catalog_key">Key *</label>
                <input type="text" id="song_catalog_key" name="song_catalog[key]" value="<%= @song_catalog.key %>" list="edit_catalog_key_options" required placeholder="Select or type key (e.g., C, Dm, F#)">
                <datalist id="edit_catalog_key_options">
                    <% ['C', 'C#/Db', 'D', 'D#/Eb', 'E', 'F', 'F#/Gb', 'G', 'G#/Ab', 'A', 'A#/Bb', 'B', 'Cm', 'C#m/Dbm', 'Dm', 'D#m/Ebm', 'Em', 'Fm', 'F#m/Gbm', 'Gm', 'G#m/Abm', 'Am', 'A#m/Bbm', 'Bm'].each do |key| %>
                        <option value="<%= key %>"><%= key %></option>
                    <% end %>
                </datalist>
            </div>

            <div class="form-group">
                <label for="song_catalog_original_key">Original Key</label>
                <input type="text" id="song_catalog_original_key" name="song_catalog[original_key]" value="<%= @song_catalog.original_key %>" list="edit_catalog_original_key_options" placeholder="Select or type original key (e.g., C, Dm, F#)">
                <datalist id="edit_catalog_original_key_options">
                    <% ['C', 'C#/Db', 'D', 'D#/Eb', 'E', 'F', 'F#/Gb', 'G', 'G#/Ab', 'A', 'A#/Bb', 'B', 'Cm', 'C#m/Dbm', 'Dm', 'D#m/Ebm', 'Em', 'Fm', 'F#m/Gbm', 'Gm', 'G#m/Abm', 'Am', 'A#m/Bbm', 'Bm'].each do |key| %>
                        <option value="<%= key %>"><%= key %></option>
                    <% end %>
                </datalist>
            </div>
        </div>
    </div>

    <div style="display: grid; grid-template-columns: 1fr; gap: 20px;">
        <div class="form-grid" style="display: grid; grid-template-columns: 1fr; gap: 20px;">
            <div class="form-group">
                <label for="song_catalog_tempo">Tempo (BPM)</label>
                <input type="number" id="song_catalog_tempo" name="song_catalog[tempo]" value="<%= @song_catalog.tempo %>" min="1" max="300">
            </div>

            <div class="form-group">
                <label for="song_catalog_genre">Genre</label>
                <input type="text" id="song_catalog_genre" name="song_catalog[genre]" value="<%= @song_catalog.genre %>" placeholder="e.g., Rock, Jazz, Pop">
            </div>
        </div>
    </div>

    <div style="display: grid; grid-template-columns: 1fr; gap: 20px;">
        <div class="form-grid" style="display: grid; grid-template-columns: 1fr; gap: 20px;">
            <div class="form-group">
                <label for="song_catalog_duration">Duration *</label>
                <input type="text" id="song_catalog_duration" name="song_catalog[duration]" value="<%= @song_catalog.duration %>" placeholder="e.g., 3:45" required>
            </div>

            <div class="form-group">
                <label for="song_catalog_year">Year</label>
                <input type="number" id="song_catalog_year" name="song_catalog[year]" value="<%= @song_catalog.year %>" min="1900" max="2030" placeholder="e.g., 2020">
            </div>
        </div>
    </div>



    <div class="form-group">
        <label for="song_catalog_url">Streaming URL</label>
        <input type="url" id="song_catalog_url" name="song_catalog[url]" value="<%= @song_catalog.url %>" placeholder="https://www.youtube.com/watch?v=... or Spotify/Apple Music link">
    </div>

    <div class="form-group">
        <label for="song_catalog_notes">Notes</label>
        <textarea id="song_catalog_notes" name="song_catalog[notes]" rows="4" placeholder="Any additional notes about the song, chords, etc."><%= @song_catalog.notes %></textarea>
    </div>

    <div class="form-group">
        <label for="song_catalog_lyrics">Lyrics</label>
        <textarea id="song_catalog_lyrics" name="song_catalog[lyrics]" rows="8" placeholder="Song lyrics..."><%= @song_catalog.lyrics %></textarea>
    </div>

    <div class="actions">
        <button type="submit" class="btn btn-success" onclick="return confirmUpdate()">Update Song Catalog</button>
        <a href="/song_catalogs" class="btn">Cancel</a>
    </div>
</form>

<div class="card" style="margin-top: 20px;">
    <h3>Song Management</h3>
    <% if @song_catalog.archived? %>
        <form method="POST" action="/song_catalogs/<%= @song_catalog.id %>/unarchive" style="margin-top: 15px;">
            <button type="submit" class="btn btn-success" onclick="return confirm('Are you sure you want to unarchive this song catalog entry? It will be available again in the catalog.')">
                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="vertical-align: -2px; margin-right: 6px;">
                    <path d="M21 16V8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73l7 4a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16z"></path>
                    <polyline points="7.5,4.21 12,6.81 16.5,4.21"></polyline>
                    <polyline points="7.5,19.79 7.5,14.6 3,12"></polyline>
                    <polyline points="21,12 16.5,14.6 16.5,19.79"></polyline>
                </svg>
                Unarchive Song Catalog
            </button>
        </form>
    <% else %>
        <form method="POST" action="/song_catalogs/<%= @song_catalog.id %>/archive" style="margin-top: 15px;">
            <button type="submit" class="btn btn-warning" onclick="return confirm('Are you sure you want to archive this song catalog entry? It will be hidden from the main catalog but can be restored later.')">
                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="vertical-align: -2px; margin-right: 6px;">
                    <polyline points="21,8 21,21 3,21 3,8"></polyline>
                    <rect x="1" y="3" width="22" height="5"></rect>
                    <line x1="10" y1="12" x2="14" y2="12"></line>
                </svg>
                Archive Song Catalog
            </button>
        </form>
    <% end %>
</div>

<script>
document.addEventListener('DOMContentLoaded', function() {
    const keyInput = document.getElementById('song_catalog_key');
    const originalKeyInput = document.getElementById('song_catalog_original_key');

    // Auto-populate original key when key is changed (if original key is empty)
    keyInput.addEventListener('input', function() {
        // Only set original key if it hasn't been set yet (is empty)
        if (originalKeyInput.value === '') {
            originalKeyInput.value = this.value;
        }
    });

    // Also trigger on datalist selection (change event)
    keyInput.addEventListener('change', function() {
        // Only set original key if it hasn't been set yet (is empty)
        if (originalKeyInput.value === '') {
            originalKeyInput.value = this.value;
        }
    });
});

function confirmUpdate() {
    return confirm('Warning: You are about to update a song catalog entry.\n\nThis will change the song information for ALL users who have access to the song catalog. Existing band-specific copies will not be affected, but new copies will use the updated information.\n\nAre you sure you want to continue?');
}
</script>